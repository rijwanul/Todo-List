<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TaskMaster Pro | Advanced To-Do List</title>
    <!-- Dynamically handle styles for GitHub Pages -->
    <script>
        // Create and inject stylesheet
        const linkElem = document.createElement('link');
        linkElem.rel = 'stylesheet';
        linkElem.href = './styles.css';
        document.head.appendChild(linkElem);
        
        // Fallback in case the above doesn't work
        setTimeout(function() {
            // Check if styles were loaded correctly
            const allStyles = document.styleSheets;
            let stylesLoaded = false;
            
            for (let i = 0; i < allStyles.length; i++) {
                try {
                    if (allStyles[i].href && allStyles[i].href.includes('styles.css')) {
                        stylesLoaded = true;
                        break;
                    }
                } catch (e) {
                    // Some browsers throw when accessing cross-domain stylesheets
                }
            }
            
            if (!stylesLoaded) {
                console.warn('Styles not loaded. Trying alternative method...');
                // Try alternative method - fetch and inject inline
                fetch('./styles.css')
                    .then(response => response.text())
                    .then(css => {
                        const styleElem = document.createElement('style');
                        styleElem.textContent = css;
                        document.head.appendChild(styleElem);
                        console.log('Styles injected inline');
                    })
                    .catch(err => {
                        console.error('Failed to load styles:', err);
                        // Last resort - try different casing
                        fetch('./Styles.css')
                            .then(response => response.text())
                            .then(css => {
                                const styleElem = document.createElement('style');
                                styleElem.textContent = css;
                                document.head.appendChild(styleElem);
                                console.log('Styles loaded with alternate casing');
                            })
                            .catch(err => console.error('All style loading attempts failed'));
                    });
            }
        }, 1000);
    </script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="icon" href="https://cdn-icons-png.flaticon.com/512/2387/2387635.png" type="image/png">
    <!-- Critical CSS for immediate rendering -->
    <style>
        :root {
            --primary-color: #5b21b6;
            --primary-dark: #4c1d95;
            --secondary-color: #ddd6fe;
            --text-color: #1f2937;
            --text-light: #6b7280;
            --bg-color: #f3f4f6;
            --card-bg: #ffffff;
            --border-color: #e5e7eb;
            --completed-color: #9ca3af;
            --delete-color: #ef4444;
            --success-color: #10b981;
        }
        
        body {
            font-family: 'Inter', -apple-system, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            line-height: 1.6;
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 2rem;
            background-color: var(--card-bg);
            border-radius: 16px;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
        }
        
        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            padding-bottom: 1.5rem;
            border-bottom: 2px solid var(--accent-light);
        }
        
        .btn {
            cursor: pointer;
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 0.75rem 1.25rem;
            border-radius: 8px;
            font-weight: 600;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1><i class="fas fa-check-square"></i> TaskMaster Pro</h1>
            <button id="theme-toggle" class="btn theme-toggle" aria-label="Toggle theme">
                <i class="fas fa-moon"></i>
            </button>
        </header>

        <div class="add-task-container">
            <input type="text" id="new-task" placeholder="What needs to be done?" autofocus>
            <button id="add-task-btn" class="btn add-btn"><i class="fas fa-plus"></i> Add Task</button>
        </div>

        <div class="filter-container">
            <select id="filter-tasks" aria-label="Filter tasks">
                <option value="all">All Tasks</option>
                <option value="active">Active</option>
                <option value="completed">Completed</option>
            </select>
            <button id="undo-btn" class="btn undo-btn" title="Undo last action" aria-label="Undo"><i class="fas fa-undo"></i></button>
            <button id="redo-btn" class="btn redo-btn" title="Redo last action" aria-label="Redo"><i class="fas fa-redo"></i></button>
            <button id="import-export-toggle" class="btn import-export-btn"><i class="fas fa-file-import"></i> Import/Export</button>
        </div>

        <div class="drag-instructions">
            <i class="fas fa-info-circle"></i> Drag tasks to reorder them
        </div>

        <ul id="task-list" aria-label="Task list"></ul>

        <div class="action-buttons">
            <button id="clear-all-btn" class="btn delete-btn"><i class="fas fa-trash-alt"></i> Clear All Tasks</button>
        </div>

        <div id="import-export-panel" class="import-export-panel">
            <div class="export-section">
                <h3><i class="fas fa-file-export"></i> Export Tasks</h3>
                <button id="copy-tasks-btn" class="btn copy-btn"><i class="fas fa-copy"></i> Copy All Tasks</button>
            </div>
            <div class="import-section">
                <h3><i class="fas fa-file-import"></i> Import Tasks</h3>
                <textarea id="import-tasks" placeholder="Paste your tasks here in any format..."></textarea>
                <button id="import-tasks-btn" class="btn import-btn"><i class="fas fa-file-import"></i> Import Tasks</button>
            </div>
        </div>
    </div>
    
    <!-- Diagnostic panel for GitHub Pages -->
    <div id="diagnostics-panel" style="position:fixed;bottom:10px;right:10px;background:rgba(0,0,0,0.8);color:white;padding:10px;border-radius:5px;font-size:12px;max-width:300px;z-index:9999;display:none;">
        <h4 style="margin:0 0 5px 0;color:#f0f0f0;">Application Diagnostics</h4>
        <div id="diagnostics-content">Initializing...</div>
        <button id="hide-diagnostics" style="background:#333;border:1px solid #666;color:#fff;padding:2px 5px;margin-top:5px;cursor:pointer;">Hide</button>
    </div>

    <!-- Error handling for GitHub Pages debugging -->
    <script>
        // Show diagnostics panel with Alt+D
        document.addEventListener('keydown', function(e) {
            if (e.altKey && e.key === 'd') {
                document.getElementById('diagnostics-panel').style.display = 'block';
            }
        });
        
        // Hide diagnostics panel
        document.getElementById('hide-diagnostics').addEventListener('click', function() {
            document.getElementById('diagnostics-panel').style.display = 'none';
        });
        
        window.addEventListener('error', function(e) {
            console.error('Error caught:', e.message, 'at', e.filename, 'line', e.lineno);
            if (!document.getElementById('error-display')) {
                const errorDisplay = document.createElement('div');
                errorDisplay.id = 'error-display';
                errorDisplay.style.position = 'fixed';
                errorDisplay.style.bottom = '10px';
                errorDisplay.style.left = '10px';
                errorDisplay.style.padding = '10px';
                errorDisplay.style.backgroundColor = 'rgba(255, 0, 0, 0.8)';
                errorDisplay.style.color = 'white';
                errorDisplay.style.borderRadius = '5px';
                errorDisplay.style.zIndex = '9999';
                errorDisplay.style.maxWidth = '80%';
                errorDisplay.style.display = 'none';
                document.body.appendChild(errorDisplay);
            }
            document.getElementById('error-display').textContent = `Error: ${e.message}`;
            document.getElementById('error-display').style.display = 'block';
        });

        // Robust script loading for GitHub Pages
        function loadScript(url, callback) {
            const script = document.createElement('script');
            script.type = 'text/javascript';
            
            if (script.readyState) { // For old IE
                script.onreadystatechange = function() {
                    if (script.readyState === 'loaded' || script.readyState === 'complete') {
                        script.onreadystatechange = null;
                        callback();
                    }
                };
            } else {
                script.onload = function() {
                    callback();
                };
            }
            
            script.src = url;
            document.body.appendChild(script);
        }
        
        // Update diagnostics
        function updateDiagnostics(message) {
            const diagContent = document.getElementById('diagnostics-content');
            const timestamp = new Date().toLocaleTimeString();
            diagContent.innerHTML += `<div>[${timestamp}] ${message}</div>`;
        }
        
        updateDiagnostics('Starting script loading...');
        
        // Try to load the script with proper error handling
        loadScript('./script.js', function() {
            console.log('Main script loaded successfully');
            updateDiagnostics('Script loaded via script tag');
        });
        
        // Backup approach - fetch and evaluate the script
        setTimeout(function() {
            // Check if our event listeners have been set up (indicating the script loaded)
            const addTaskBtn = document.getElementById('add-task-btn');
            updateDiagnostics('Checking if event handlers were set up...');
            if (!addTaskBtn || !addTaskBtn.onclick) {
                updateDiagnostics('Event handlers not found, trying alternative loading...');
                console.warn('Script may not have loaded properly, trying alternative method...');
                
                fetch('./script.js')
                    .then(response => {
                        if (!response.ok) {
                            throw new Error(`Failed to fetch script: ${response.status}`);
                        }
                        return response.text();
                    })
                    .then(jsContent => {
                        console.log('Script fetched successfully, evaluating...');
                        // Add a note to the code before evaluating it
                        const scriptContent = `
                        // This script was loaded via fetch and eval due to loading issues
                        // Original script: script.js
                        ${jsContent}
                        `;
                        
                        // Create a script element for better debugging
                        const scriptElem = document.createElement('script');
                        scriptElem.textContent = scriptContent;
                        document.body.appendChild(scriptElem);
                        
                        console.log('Script evaluated');
                        updateDiagnostics('Script loaded and evaluated via fetch');
                    })
                    .catch(err => {
                        console.error('Failed to load script via fetch:', err);
                        updateDiagnostics(`Error loading script: ${err.message}`);
                        // Try with different casing as last resort
                        fetch('./Script.js')
                            .then(response => response.text())
                            .then(jsContent => {
                                const scriptElem = document.createElement('script');
                                scriptElem.textContent = jsContent;
                                document.body.appendChild(scriptElem);
                                console.log('Script loaded with alternate casing');
                            })
                            .catch(() => {
                                // If all else fails, show error to user
                                const errorMsg = document.createElement('div');
                                errorMsg.style.padding = '20px';
                                errorMsg.style.margin = '20px auto';
                                errorMsg.style.backgroundColor = '#f8d7da';
                                errorMsg.style.color = '#721c24';
                                errorMsg.style.borderRadius = '5px';
                                errorMsg.style.textAlign = 'center';
                                errorMsg.innerHTML = `<h3>Error Loading Application</h3>
                                <p>Failed to load the application script. This may be due to network issues or deployment configuration.</p>
                                <p>Try refreshing the page or contact the website administrator.</p>`;
                                document.querySelector('.container').prepend(errorMsg);
                            });
                    });
            }
        }, 2000);
    </script>
</body>
</html>
